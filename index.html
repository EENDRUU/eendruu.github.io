<html>
    <title>Firebase Messaging Demo</title>
    <style>
        div {
            margin-bottom: 15px;
        }
    </style>
    <head>
        <link rel="shortcut icon" type="image/x-icon" href="logo.png" />
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    </head>
    <body>
        <div id="msg"></div>
        <div id="notis"></div>
        <div id="err"></div>
        <div>
            <input type="text" id="token" style="display: none;"/>
            <input type="text" id="title" placeholder="Masukan judul Notififikasi"/>
            <input type="text" id="body" placeholder="Masukan pesan"/>
            <button id="btnSend" onclick="sendNotif()">Send Notif</button>
        </div>
        <!-- The core Firebase JS SDK is always required and must be listed first -->
        <script src="https://www.gstatic.com/firebasejs/8.4.2/firebase-app.js"></script>

        <script src="https://www.gstatic.com/firebasejs/7.16.1/firebase-messaging.js"></script>
        <script>
            MsgElem = document.getElementById('msg');
            TokenElem = document.getElementById('token');
            NotisElem = document.getElementById('notis');
            ErrElem = document.getElementById('err');
            title = document.getElementById('title');
            body = document.getElementById('body');

            // TODO: Replace firebaseConfig you get from Firebase Console
            const firebaseConfig = {
                apiKey: "AIzaSyDdJU15wu-o9vxBoxrEjVDuDobX5Laddz8",
                authDomain: "notificationidm.firebaseapp.com",
                projectId: "notificationidm",
                storageBucket: "notificationidm.appspot.com",
                messagingSenderId: "907785559629",
                appId: "1:907785559629:web:69a6786819eaa563318604",
                measurementId: "G-RNEH6ZGNW8"
                };
            firebase.initializeApp(firebaseConfig);

            const messaging = firebase.messaging();
            messaging
                .requestPermission()
                .then(function () {
                    MsgElem.innerHTML = 'Notification permission granted.';
                    console.log('Notification permission granted.');

                    // get the token in the form of promise
                    return messaging.getToken();
                })
                .then(function (token) {
                    TokenElem.value = 'Device token is : <br>' + token;
                })
                .catch(function (err) {
                    ErrElem.innerHTML = ErrElem.innerHTML + '; ' + err;
                    console.log('Unable to get permission to notify.', err);
                });

            let enableForegroundNotification = true;
            messaging.onMessage(function (payload) {
                console.log('Message received. ', payload);
                NotisElem.innerHTML =
                    NotisElem.innerHTML + JSON.stringify(payload);

                if (enableForegroundNotification) {
                    let notification = payload.notification;
                    const notificationOptions = {
                        body: notification.body,
                        icon: "logo.png",
                    };
                    navigator.serviceWorker
                        .getRegistrations()
                        .then((registration) => {
                            registration[0].showNotification(notification.title,notificationOptions);
                        });
                }
            });


            function sendnotif(){
                console.log(TokenElem.value);
                console.log(title.value);
                console.log(body.value);
                $.ajax({
                    url: 'https://fcm.googleapis.com/fcm/send',
                    type: 'post',
                    data: {
                        
                        to : TokenElem.value,
                        collapse_key : "green",
                        notification : {
                            body : body.value,
                            title: title.value,
                            icon: "logo.png"
                        }

                    },
                    headers: {
                        Authorization: 'key=AAAA01w8Xk0:APA91bGcm6i-CQnfoMig6Y2JlwfyhIecg2rs2vjBfh4GxL96mBTHfl5uR-nrx8AU0jXo1qvv91mCNryfgeVtzEkCWU4uEs2jwsa8iorEQ_BkocKp8hDfWAkcwcjthSePZO8aakH3NcnY',  
                        "Content-Type": 'application/json'  //for object property name, use quoted notation shown in second
                    },
                    dataType: 'json',
                    success: function (data) {
                        console.info(data);
                    }
                });

            }

            
        </script>
    </body>
</html>
